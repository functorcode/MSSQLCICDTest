name: build-pipeline
on: [push]
jobs:
    build:
        runs-on: self-hosted
        steps:
            - name: checkout code
              uses: actions/checkout@v3
            - name: add msbuild to path
              uses: microsoft/setup-msbuild@v1.3.1
            - name: Build now
              run: |
                msbuild -p:Configuration=Release
            # Publish artifact
            - uses: actions/upload-artifact@v3.1.2
              with:
                  name: MSSQLCICDTEST
                  path: ${{ github.workspace }}\MSSQLCICD\bin\Release\
    deploytestenv:
        name: deploy on test enviorment
        needs: [build]
        environment: testenv
        runs-on: self-hosted
        steps:
            - name: download artifact
              uses: actions/download-artifact@v3.0.2
              with:
                name: MSSQLCICDTEST
            - name : setup dotnet
              uses: actions/setup-dotnet@v3
            - name : install sql package
              run: |
                dotnet tool install microsoft.sqlpackage
            
